<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Weather Board Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css">
    <style>
        :root {
            --bg-color: #000;
            --main-text: #fff;
            --sub-text: #555;
            --label-text: #888;
            --dim-text: #aaa;
            --border-color: #333;
            --scroll-bar: #222;
        }

        html, body { height: 100%; margin: 0; padding: 0; background: var(--bg-color); color: var(--main-text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; overflow: hidden; -webkit-user-select: none; user-select: none; }
        #container { display: flex; width: 100%; height: 100%; cursor: pointer; position: relative; }
        
        #left { flex: 38; display: flex; flex-direction: column; border-right: 1px solid var(--border-color); height: 100%; z-index: 2; background: var(--bg-color); box-sizing: border-box; }
        #right { flex: 62; height: 100%; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 0 2vh; box-sizing: border-box; }
        #right::-webkit-scrollbar { width: 4px; }
        #right::-webkit-scrollbar-thumb { background: var(--scroll-bar); border-radius: 10px; }

        @media (orientation: portrait) {
            #left { flex: 100; border-right: none; }
            #right { display: none; }
            .section-label { font-size: 5vh !important; } /* スマホ縦持ち時さらに大きく */
            .clock-display { font-size: 11vh !important; }
            .icon-display { font-size: 11vh !important; width: 12vh !important; }
            .temp-display { font-size: 15vh !important; }
            .current-detail { font-size: 6vh !important; }
        }

        .weather-section { height: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; padding: 2vh 0; box-sizing: border-box; }
        
        /* 日付ラベルの強化 */
        .section-label { font-size: 3.5vh; color: #fff; letter-spacing: 0.1em; font-weight: bold; margin-bottom: 2vh; text-transform: uppercase; }
        
        .top-row { display: flex; align-items: center; justify-content: center; gap: 3vw; margin-bottom: 1vh; }
        .clock-display { font-size: 8.5vh; color: var(--dim-text); font-weight: 200; font-variant-numeric: tabular-nums; line-height: 1; }
        
        .icon-display { font-size: 9vh; width: 14vh; height: 10vh; display: flex; align-items: center; justify-content: center; filter: brightness(1.6); }
        .h-icon { font-size: 4.2vh; filter: brightness(1.6); display: flex; align-items: center; justify-content: center; }

        .bottom-row { display: flex; align-items: center; justify-content: center; gap: 4vw; }
        .temp-display { font-size: 11.5vh; font-weight: bold; line-height: 0.9; font-variant-numeric: tabular-nums; }
        
        /* 明日の最高・最低気温用（フォントサイズ・色を統一） */
        .temp-stack { display: flex; flex-direction: column; align-items: flex-end; justify-content: center; }
        .temp-max-min { font-size: 7.2vh; font-weight: bold; color: #fff; line-height: 1; font-variant-numeric: tabular-nums; }
        .temp-divider { width: 100%; height: 1px; background: #444; margin: 4px 0; }

        .details-group { display: flex; flex-direction: column; justify-content: center; gap: 0.5vh; }
        .current-detail { display: flex; align-items: baseline; font-size: 4.8vh; font-weight: bold; }
        .detail-label { font-size: 1.6vh; color: var(--sub-text); width: 6vh; font-weight: normal; margin-right: 4px; }
        .num-val { display: inline-block; width: 6.5vh; text-align: right; font-variant-numeric: tabular-nums; }
        .unit { font-size: 2.2vh; color: var(--label-text); margin-left: 2px; }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        thead { position: sticky; top: 0; background: var(--bg-color); z-index: 3; }
        th { color: var(--label-text); font-size: 2.5vh; border-bottom: 2px solid #333; height: 9vh; vertical-align: middle; font-weight: normal; }
        td { text-align: center; border-bottom: 1px solid #1a1a1a; font-size: 3.5vh; height: 11vh; vertical-align: middle; font-variant-numeric: tabular-nums; }

        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        #modal { background: #111; padding: 30px; border: 1px solid #333; border-radius: 16px; width: 340px; }
        #modal h2 { margin-top: 0; font-size: 16px; color: var(--label-text); text-align: center; letter-spacing: 3px; margin-bottom: 25px; }
        .input-group { margin: 15px 0; }
        .input-group label { display: block; font-size: 11px; color: #555; margin-bottom: 6px; }
        .input-group input { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 12px; box-sizing: border-box; font-size: 16px; border-radius: 8px; outline: none; }
        .btn-row { display: flex; flex-direction: column; gap: 10px; margin-top: 30px; }
        .btn-main-row { display: flex; gap: 10px; }
        button { flex: 1; padding: 14px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .save-btn { background: #fff; color: #000; }
        .cancel-btn { background: #222; color: #fff; }
        .reset-btn { background: transparent; color: #444; font-size: 11px; text-decoration: underline; margin-top: 5px; }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="container">
    <div id="left">
        <section class="weather-section" style="border-bottom: 1px solid #1a1a1a;">
            <div id="date-today" class="section-label">--/-- ---</div>
            <div class="top-row">
                <div id="clock" class="clock-display">--:--</div>
                <div id="icon-now" class="icon-display"></div>
            </div>
            <div class="bottom-row">
                <div id="temp-now" class="temp-display">--°</div>
                <div class="details-group">
                    <div class="current-detail"><span class="detail-label">RAIN</span><span id="rain-now" class="num-val">--</span><span class="unit">%</span></div>
                    <div class="current-detail"><span class="detail-label">HUMI</span><span id="humi-now" class="num-val">--</span><span class="unit">%</span></div>
                </div>
            </div>
        </section>
        <section class="weather-section">
            <div id="date-tomorrow" class="section-label">--/-- ---</div>
            <div class="top-row"><div id="icon-tom" class="icon-display"></div></div>
            <div class="bottom-row">
                <div class="temp-stack">
                    <div id="temp-tom-max" class="temp-max-min">--°</div>
                    <div class="temp-divider"></div>
                    <div id="temp-tom-min" class="temp-max-min">--°</div>
                </div>
                <div class="details-group">
                    <div class="current-detail"><span class="detail-label">RAIN</span><span id="rain-tom" class="num-val">--</span><span class="unit">%</span></div>
                    <div class="current-detail"><span class="detail-label">HUMI</span><span id="humi-tom" class="num-val">--</span><span class="unit">%</span></div>
                </div>
            </div>
        </section>
    </div>
    <div id="right">
        <table>
            <thead><tr><th>TIME</th><th>SKY</th><th>TEMP</th><th>RAIN</th><th>HUMI</th></tr></thead>
            <tbody id="forecast-body"></tbody>
        </table>
    </div>
</div>

<div id="overlay">
    <div id="modal">
        <h2>LOCATION SETTINGS</h2>
        <div class="input-group">
            <label>Latitude</label><input type="number" id="lat-input" step="0.0001">
        </div>
        <div class="input-group">
            <label>Longitude</label><input type="number" id="lon-input" step="0.0001">
        </div>
        <div class="btn-row">
            <div class="btn-main-row">
                <button class="cancel-btn" onclick="toggleSettings(false)">Cancel</button>
                <button class="save-btn" onclick="saveSettings()">Save</button>
            </div>
            <button class="reset-btn" onclick="resetToDefault()">Reset to Default Location</button>
        </div>
    </div>
</div>

<script>
    const DEFAULT_LOC = { lat: 34.7567, lon: 135.486 };
    let CONFIG = {
        lat: parseFloat(localStorage.getItem('lat')) || DEFAULT_LOC.lat,
        lon: parseFloat(localStorage.getItem('lon')) || DEFAULT_LOC.lon,
        updateFreq: 600000
    };

    let sunData = { sunrise: 360, sunset: 1080 };
    let pressTimer;
    const container = document.getElementById('container');
    const rightSide = document.getElementById('right');

    const handleStart = () => { pressTimer = setTimeout(() => { toggleSettings(true); pressTimer = null; }, 3000); };
    const handleEnd = (e) => { 
        if (pressTimer) { 
            clearTimeout(pressTimer); 
            pressTimer = null; 
            if (e.currentTarget === container && !rightSide.contains(e.target)) {
                 toggleFullscreen();
            }
        } 
    };

    container.addEventListener('mousedown', handleStart);
    container.addEventListener('touchstart', handleStart);
    container.addEventListener('mouseup', handleEnd);
    container.addEventListener('touchend', handleEnd);

    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen?.() || document.documentElement.webkitRequestFullscreen?.();
        }
    }

    function toggleSettings(show) {
        document.getElementById('overlay').style.display = show ? 'flex' : 'none';
        if(show) {
            document.getElementById('lat-input').value = CONFIG.lat;
            document.getElementById('lon-input').value = CONFIG.lon;
        }
    }

    function resetToDefault() {
        document.getElementById('lat-input').value = DEFAULT_LOC.lat;
        document.getElementById('lon-input').value = DEFAULT_LOC.lon;
    }

    function saveSettings() {
        const lat = parseFloat(document.getElementById('lat-input').value);
        const lon = parseFloat(document.getElementById('lon-input').value);
        if (!isNaN(lat) && !isNaN(lon)) {
            CONFIG.lat = lat; CONFIG.lon = lon;
            localStorage.setItem('lat', lat); localStorage.setItem('lon', lon);
            toggleSettings(false); updateWeather();
        }
    }

    function isNight(date) {
        const m = date.getHours() * 60 + date.getMinutes();
        return m < sunData.sunrise || m > sunData.sunset;
    }

    function getIconHTML(code, date) {
        const night = isNight(date);
        let icon = "wi-cloudy";
        if (code <= 1) icon = night ? "wi-night-clear" : "wi-day-sunny";
        else if (code === 2) icon = night ? "wi-night-alt-cloudy" : "wi-day-cloudy";
        else if (code === 3) icon = "wi-cloudy";
        else if (code >= 45 && code <= 48) icon = night ? "wi-night-fog" : "wi-fog";
        else if (code >= 51 && code <= 55) icon = night ? "wi-night-alt-showers" : "wi-day-showers";
        else if (code >= 61 && code <= 65) icon = "wi-rain";
        else if (code >= 71 && code <= 77) icon = "wi-snow";
        else if (code >= 80 && code <= 82) icon = night ? "wi-night-alt-rain" : "wi-day-rain";
        else if (code >= 95) icon = "wi-thunderstorm";
        return `<i class="wi ${icon}"></i>`;
    }

    function formatDate(date) {
        const weeks = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        return `${date.getMonth() + 1}/${date.getDate()} (${weeks[date.getDay()]})`;
    }

    function updateTime() {
        const now = new Date();
        document.getElementById("clock").textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    }

    async function updateWeather() {
        updateTime();
        try {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${CONFIG.lat}&longitude=${CONFIG.lon}&hourly=temperature_2m,precipitation_probability,relative_humidity_2m,weathercode&daily=sunrise,sunset,weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max&current_weather=true&timezone=auto`;
            const res = await fetch(url);
            const data = await res.json();
            
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(now.getDate() + 1);

            document.getElementById("date-today").textContent = formatDate(now);
            document.getElementById("date-tomorrow").textContent = formatDate(tomorrow);

            const sr = new Date(data.daily.sunrise[0]);
            const ss = new Date(data.daily.sunset[0]);
            sunData.sunrise = sr.getHours() * 60 + sr.getMinutes();
            sunData.sunset = ss.getHours() * 60 + ss.getMinutes();

            const h = now.getHours();
            document.getElementById("icon-now").innerHTML = getIconHTML(data.current_weather.weathercode, now);
            document.getElementById("temp-now").textContent = `${Math.round(data.current_weather.temperature)}°`;
            document.getElementById("rain-now").textContent = data.hourly.precipitation_probability[h];
            document.getElementById("humi-now").textContent = data.hourly.relative_humidity_2m[h];

            // 明日サマリー
            document.getElementById("icon-tom").innerHTML = getIconHTML(data.daily.weathercode[1], tomorrow);
            document.getElementById("temp-tom-max").textContent = `${Math.round(data.daily.temperature_2m_max[1])}°`;
            document.getElementById("temp-tom-min").textContent = `${Math.round(data.daily.temperature_2m_min[1])}°`;
            document.getElementById("rain-tom").textContent = data.daily.precipitation_probability_max[1];
            
            const tomHumiArr = data.hourly.relative_humidity_2m.slice(24, 48);
            document.getElementById("humi-tom").textContent = Math.max(...tomHumiArr);

            let html = "";
            for(let i=1; i<=24; i++) {
                const idx = h + i;
                if(!data.hourly.time[idx]) break;
                const d = new Date(data.hourly.time[idx]);
                html += `<tr><td>${d.getHours()}:00</td><td class="h-icon">${getIconHTML(data.hourly.weathercode[idx], d)}</td><td>${Math.round(data.hourly.temperature_2m[idx])}°</td><td>${data.hourly.precipitation_probability[idx]}%</td><td>${data.hourly.relative_humidity_2m[idx]}%</td></tr>`;
            }
            document.getElementById("forecast-body").innerHTML = html;
        } catch (e) { console.error(e); }
    }

    updateWeather();
    setInterval(updateWeather, CONFIG.updateFreq);
    setInterval(updateTime, 1000);
</script>
</body>
</html>
